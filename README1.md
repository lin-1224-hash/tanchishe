《贪吃蛇游戏》软件分析与设计说明书

一、项目概述
1.1 项目名称
基于C语言的控制台贪吃蛇游戏（支持用户系统、日志记录与状态恢复）
1.2 项目背景
贪吃蛇是经典的益智游戏，具有简单的规则和较强的趣味性。本项目使用 C 语言和 Windows 控制台技术实现该游戏，并加入用户管理系统、日志记录、游戏状态保存与恢复等功能，提升项目复杂度与可玩性，适合初学者学习结构化程序设计与文件操作技巧。
1.3 项目目标
实现经典贪吃蛇的基本玩法；
提供良好的图形化控制台界面；
实现注册、登录、退出机制；
支持游戏得分与历史记录保存；
支持游戏状态的实时保存和恢复；
提供易于使用的人机交互体验。

二、需求分析
2.1 功能需求
编号	功能名称	功能说明
1	用户注册	用户可以通过用户名和密码创建账户（存储于 users.txt）
2	用户登录	验证用户名与密码，允许合法用户进入游戏
3	游戏地图绘制	使用控制台字符绘制地图边框
4	贪吃蛇移动控制	支持上下左右控制蛇移动，自动刷新界面
5	食物生成与得分	随机生成食物，被蛇吃到后蛇增长并加分
6	撞墙/咬到自己检测	游戏失败处理：撞墙或咬到自己
7	游戏暂停/继续	支持空格暂停、再次按空格继续
8	状态保存/恢复	保存当前蛇位置、食物位置、分数等，用于恢复
9	日志记录	记录每次游戏的开始时间、结束时间、得分、原因等到 game_logs.txt
10	日志查看	显示所有用户的游戏记录，支持格式化输出
11	游戏退出	支持主动退出，并记录日志
2.2 非功能需求
系统运行稳定，不发生内存泄漏；
用户体验良好，界面简洁明了；
控制响应及时，游戏操作流畅；
所有数据存储基于文件，无需数据库支持。

三、总体设计
3.1 功能模块层次方框图


四、详细模块设计
4.1 用户管理模块
4.1.1 registerUser()
功能：实现用户注册功能，用户名不能重复
输入：用户名和密码
输出：写入 users.txt
4.1.2 loginUser()
功能：验证用户名和密码是否匹配
返回值：成功返回1，失败返回0
文件：读取 users.txt

4.2 游戏地图模块
creatMap()
功能：创建固定边框，范围：x=026
实现：使用字符“■”在边界绘制墙壁

4.3 贪吃蛇控制模块
initsnake()
初始化：蛇默认长度5节，横向排列
snakemove()
移动逻辑：
o根据方向创建新蛇头；
o若吃到食物，增长并生成新食物；
o否则删除尾部实现“前进”效果；
o每次更新控制台字符显示。
biteself()、cantcrosswall()
功能：检查是否撞墙或咬到自己，返回失败状态

4.4 食物与得分模块
createfood()
功能：在地图空白处随机生成食物；
避免重合：不得与蛇身坐标重复

4.5 游戏状态模块
save_game_state()
保存内容：蛇身节点、食物坐标、当前得分
数据结构：GameState 结构体保存至内存
restore_game_state()
恢复内容：使用 GameState 重建蛇与食物位置，并更新得分、UI

4.6 日志记录模块
recordGameLog()
功能：记录一局游戏的开始时间、结束时间、得分、失败原因
文件存储：保存到 game_logs.txt
格式：log_id username start_time end_time score reason
displayGameLogs()
功能：清屏后读取所有日志，格式化输出并分页
支持回退：查看日志后，恢复游戏状态

4.7 游戏流程控制模块
gamecircle()
主循环功能：
o持续检测键盘按键；
o响应 ESC 退出、F1 加速、F2 减速、F5 查看日志；
o实现移动与分数更新；
o检测失败状态。
endgame()
功能：根据失败原因（撞墙、咬自己、退出）显示提示并记录日志。

五、数据结构说明
5.1 蛇身链表结构体
typedef struct SNAKE {
    int x;
    int y;
    struct SNAKE* next;
} snake;
实现动态的蛇身增长与移动；
头插法实现蛇头移动，尾部删除旧节点。
5.2 用户信息结构体
typedef struct {
    char username[20];
    char password[20];
} User;
保存在 users.txt 中；
用于身份验证。
5.3 游戏日志结构体
typedef struct GameLog {
    int log_id;
    char username[20];
    time_t start_time;
    time_t end_time;
    int score;
    char game_over_reason[50];
} GameLog;
用于存储与显示游戏记录；
时间戳使用 time_t 格式，输出为标准时间格式。
5.4 游戏状态结构体
typedef struct GameState {
    int snake_nodes[1000][2]; // 蛇身每节坐标
    int snake_length;
    int food_x, food_y;
    int score;
} GameState;
在查看日志时保存当前状态；
支持恢复游戏继续操作。

六、输入输出说明
6.1 输入
键盘输入用户名、密码、方向键、功能键（F1~F5）
菜单输入 1/2/3 进行选择操作
6.2 输出
控制台字符界面
文件输出：
ousers.txt：注册用户
ogame_logs.txt：游戏日志信息

七、运行环境说明
项目	内容
操作系统	Windows 10/11
编译器	GCC / Visual Studio
依赖库	<windows.h> <time.h>
控制台设置	推荐宽度：100列，高度：30行
编码格式	UTF-8 或 ANSI

八、测试设计
测试编号	测试内容	输入	预期输出
T1	注册重复用户	已存在用户名	提示“用户名已存在”
T2	登录成功	合法用户和密码	进入游戏
T3	吃食物加分	控制蛇吃食物	分数加10，蛇增长
T4	撞墙失败	控制蛇撞墙	游戏结束，显示提示
T5	日志保存	完成游戏	game_logs.txt中新增
T6	状态恢复	中途查看日志后恢复	游戏状态无误

九、项目总结与扩展建议
9.1 总结
该项目实现了一个功能完整、界面清晰、数据可保存的控制台贪吃蛇游戏。通过模块化设计、结构体管理、文件读写、链表操作等内容，展示了 C 语言中级项目的基本素养，适合作为学习案例与课程设计项目。
9.2 可扩展性建议
增加难度选择与关卡机制；
引入数据库保存用户信息；
支持本地双人对战；
使用图形库（如 SDL）实现图形化界面；
实现排行榜与成就系统。
